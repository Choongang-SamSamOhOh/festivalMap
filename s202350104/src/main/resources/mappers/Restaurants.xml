<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oracle.s202350104.RestaurantMapper">
	<select id="joRestaurantListAll" resultType="RestaurantsContent" parameterType="RestaurantsContent">
		SELECT x.*, y.content AS theme
		FROM   
		(
			SELECT ROWNUM rn, t.*,
				(SELECT content FROM areas a
				 WHERE t.area = a.area AND a.sigungu = 999) AS area_content,
				(SELECT content FROM areas a
				 WHERE t.area = a.area AND t.sigungu = a.sigungu) AS sigungu_content 
			FROM
			(SELECT *
			 FROM restaurants r, contents c
			 WHERE r.content_id = c.id
			 ORDER BY content_id) t
		) x, commoncodes y
		WHERE rn BETWEEN #{start} and #{end}
		AND   x.big_code = y.big_code AND x.small_code = y.small_code
	</select>
	
	<select id="joRestaurantDetail" resultType="RestaurantsContent" parameterType="int">
		SELECT 	c.*, r.*, 
						(SELECT content FROM commoncodes co WHERE  c.big_code = co.big_code AND c.small_code = co.small_code) AS theme,
						(SELECT content FROM areas a WHERE c.area = a.area AND a.sigungu = 999) AS area_content,	
						(SELECT content FROM areas a WHERE c.area = a.area AND c.sigungu = a.sigungu) AS sigungu_content
		FROM 	contents c, restaurants r
		WHERE 	c.id = r.content_id
		AND 	r.content_id = #{contentId}
	</select>
	
	<select id="joRestaurantTotal" resultType="int">
		SELECT count(*)
		FROM   restaurants r, contents c
		WHERE  r.content_id = c.id
	</select>
	
	<select id="joConTotalRestaurant" resultType="int" parameterType="RestaurantsContent">
		SELECT count(*)
		FROM   restaurants r, (SELECT id
							   FROM   contents
							   WHERE  area = #{area} AND sigungu = #{sigungu}) c	
		WHERE   r.content_id = c.id  
	</select>
	
	<select id="RestaurantListAll" resultType="Restaurants">
		SELECT * FROM restaurants
	</select>
	
	<select id="joListSearchRestaurant" resultType="RestaurantsContent" parameterType="RestaurantsContent">
		SELECT *
		FROM   
		(		
				SELECT ROWNUM rn, t.*,
									  (SELECT content FROM areas a
				 					   WHERE t.area = a.area AND a.sigungu = 999) AS area_content,
									  (SELECT content FROM areas a
				 					   WHERE t.area = a.area AND t.sigungu = a.sigungu) AS sigungu_content
				
				 FROM
			    		(SELECT  *
						 FROM    restaurants r, (SELECT *
							   		   			 FROM   contents
							   		   			 WHERE  area = #{area} AND sigungu = #{sigungu}) c	
				 		 WHERE    r.content_id = c.id
				 		 ORDER BY content_id) t
		  )		 		 
		WHERE   rn between #{start} and #{end}  		  
	</select>
	
	<select id="joAdminConTotalRestaurant" resultType="int" parameterType="RestaurantsContent">
		SELECT COUNT(*)
		FROM	
				(
					SELECT c.*
	 				FROM   restaurants r, contents c
	 				WHERE  r.content_id = c.id
	 				AND    c.status = #{status} AND c.small_code = #{small_code}
	 			 )
		
	</select>	
		
	<select id="joAdminListSearchRestaurant" resultType="RestaurantsContent" parameterType="RestaurantsContent">
		SELECT  x.*, y.content AS theme
		FROM	
				(
					SELECT ROWNUM rn, c.*
	 				FROM   restaurants r, contents c
	 				WHERE  r.content_id = c.id
	 				AND    c.status = #{status} AND c.small_code = #{small_code} 
	 			 ) x, commoncodes y
		WHERE rn BETWEEN #{start} and #{end}
		AND   x.big_code = y.big_code AND x.small_code = y.small_code
	</select>	
	
	<select id="joInsertRestaurant" resultType="int" parameterType="RestaurantsContent">
		INSERT INTO restaurants(content_id, first_menu, menu, open_time, rest_date, is_smoking, is_packing, is_parking)
		VALUES				   (contents_id_seq.currval, #{first_menu}, #{menu}, #{open_time}, #{rest_date}, #{is_smoking}, #{is_packing}, #{is_parking})
	</select>
	
	<select id="joInsertContent" resultType="int" parameterType="RestaurantsContent">
		INSERT INTO contents(id, area, sigungu, big_code, small_code, title, content, status, img1, img2, img3, address, postcode, mapx, mapy, email, phone, homepage, readcound, user_id, created_at, is_deleted)
		VALUES		(contents_id_seq.nextval, #{area}, #{sigungu}, #{big_code}, #{small_code}, #{title}, #{content}, '0', #{img1}, #{img2}, #{img3}, #{address}, #{postcode}, #{mapx}, #{mapy}, #{email}, #{phone}, #{homepage}, 0, #{user_id}, sysdate, #{updated_at}, '0')
	</select>
	
</mapper>