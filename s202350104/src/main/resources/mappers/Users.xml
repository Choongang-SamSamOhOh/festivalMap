<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oracle.s202350104.UsersMapper">
 	<select id="getUserList" resultType="Users">
		SELECT *
		FROM(
	    		SELECT ROWNUM rn, users.*
				FROM users
				WHERE small_code = #{small_code}
     		) 
		WHERE rn between #{start} and #{end}
	</select>

	<select id="getSearchUserList" resultType="Users">
		SELECT * 
		FROM(
	    		SELECT ROWNUM rn, users.*
				FROM users
				WHERE small_code = #{small_code}
				<if test="keyword != null and keyword != ''">
			        <choose>
			            <!-- "searchType"이 "name"일 때 -->
			            <when test="searchType == 'name'">
							AND name like '%' || #{keyword}|| '%'
			            </when>
			            <!-- "searchType"이 "email"일 때 -->
			            <when test="searchType == 'email'">
							AND email like '%' || #{keyword}|| '%'
			            </when>
			            <!-- "searchType"이 "nickname"일 때 -->
			            <when test="searchType == 'nickname'">
							AND nickname like '%' || #{keyword}|| '%'
			            </when>
			        </choose>
		        </if>
		        <!-- "startDate"와 "endDate"로 가입일을 조회 -->
    	        <if test="startDate != null and endDate != null">
		            AND created_at BETWEEN #{startDate} AND #{endDate}
		        </if>
				<if test="is_deleted != '' and is_deleted!=null">
		            AND is_deleted = #{is_deleted}
		        </if>		        
     		) 
		WHERE rn between #{start} and #{end}
	</select>
	<select id="totalUsers" resultType="int">
   		SELECT count(*)
		FROM users
		WHERE small_code = #{small_code}
		<if test="keyword != null and keyword != ''">
	        <choose>
	            <!-- "searchType"이 "name"일 때 -->
	            <when test="searchType == 'name'">
					AND name like '%' || #{keyword}|| '%'
	            </when>
	            <!-- "searchType"이 "email"일 때 -->
	            <when test="searchType == 'email'">
					AND email like '%' || #{keyword}|| '%'
	            </when>
	            <!-- "searchType"이 "nickname"일 때 -->
	            <when test="searchType == 'nickname'">
					AND nickname like '%' || #{keyword}|| '%'
	            </when>
	        </choose>
        </if>
        <!-- "startDate"와 "endDate"로 가입일을 조회 -->
        <if test="startDate != null and endDate != null">
            AND created_at BETWEEN #{startDate} AND #{endDate}
        </if>
		<if test="is_deleted != '' and is_deleted!=null">
            AND is_deleted = #{is_deleted}
        </if>
        
	</select>
	
	<insert id="insertUser"  parameterType="Users" >
		INSERT INTO 
		users(
			id,big_code,small_code,
			name,password,nickname,birthday,
			phone_num,email,address,status,
			point,gender,created_at,updated_at,
			file_name,is_deleted	
		) 
		VALUES (
			#{id}, #{big_code}, #{small_code}, 
			#{name}, #{password}, #{nickname}, #{birthday}, 
			#{phone_num}, #{email}, #{address}, #{status}, 
			#{point}, #{gender}, sysdate, sysdate, 
			#{file_name}, 0
		)
	</insert>
    <select id="getUserByEmail" resultType="Users">
        SELECT *
        FROM Users
        WHERE email = #{email}
    </select>
    <select id="getUserById" resultType="Users">
        SELECT *
        FROM Users
        WHERE id = #{id}
    </select>
	<select id="joAdminListTotal" resultType="int">
		SELECT count(*)
		FROM   users
		WHERE  small_code = 1
	</select>
		
	<select id="joAdminListList" resultType="Users" parameterType="Users">
		SELECT *
		FROM
    		(SELECT ROWNUM rn, users.*
     		 FROM 	users
     		 WHERE  small_code = 1
     		) 
		WHERE rn between #{start} and #{end}
	</select>
	
</mapper>