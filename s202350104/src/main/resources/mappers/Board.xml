<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oracle.s202350104.BoardMapper">

	<select id="boardCount" resultType="int">
		select count(*)
		from board a, users b
		where a.user_id = b.id
		and a.small_code = #{smallCode}
	</select>
	
	<select id="boardCount2" parameterType="Board" resultType="int">
		select count(*)
		from board a 
		join users b
		on a.user_id = b.id
		join contents c
		on a.content_id = c.id
		where c.big_code = #{commBigCode}
		and c.small_code = #{commSmallCode}
	</select>

	<select id="readCountUp" resultType="int">
		update board 
		set read_count = read_count + 1 
		where id = #{boardId}
	</select>
	
	<select id="noticAllList" resultType="Board">
		select *
		from (
		    select rownum rn, c.*
		    from (
		        select a.id, a.title, b.name, a.created_at, a.read_count, a.big_code, a.small_code
		        from board a, users b
		        where a.user_id = b.id
		        and a.small_code = 1
		        and a.is_deleted = 0		        
		        order by a.id desc
		    ) c
		)
		where rn between #{start} and #{end}
	</select>

	<select id="magazinAllList" resultType="Board">
		select *
		from (
		    select rownum rn, c.*
		    from (
		        select a.id, a.title, b.name, a.created_at, a.read_count, a.big_code, a.small_code
		        from board a, users b
		        where a.user_id = b.id
		        and a.small_code = 2
		        and a.is_deleted = 0		        
		        order by a.id desc
		    ) c
		)
		where rn between #{start} and #{end}
	</select>

	<select id="freeAllList" resultType="Board">
		select *
		from (
		    select rownum rn, c.*
		    from (
		        select a.id, a.title, b.name, a.created_at, a.read_count, a.big_code, a.small_code, a.user_id
		        from board a, users b
		        where a.user_id = b.id
		        and a.small_code = 3
		        and a.is_deleted = 0
		        order by a.id desc
		    ) c
		)
		where rn between #{start} and #{end}		
	</select>
	
	<select id="photoAllList" resultType="Board">
		select *
		from (
		    select rownum rn, c.*
		    from (
		        select a.id, a.title, b.name, a.created_at, a.read_count, a.big_code, a.small_code
		        from board a, users b
		        where a.user_id = b.id
		        and a.small_code = 4
		        and a.is_deleted = 0		        
		        order by a.id desc
		    ) c
		)
		where rn between #{start} and #{end}
	</select>
	
	<select id="eventAllList" resultType="Board">
		select *
		from (
		    select rownum rn, c.*
		    from (
		        select a.id, a.title, b.name, a.created_at, a.read_count, a.big_code, a.small_code
		        from board a, users b
		        where a.user_id = b.id
		        and a.small_code = 5
		        and a.is_deleted = 0		        
		        order by a.id desc
		    ) c
		)
		where rn between #{start} and #{end}
	</select>
	
	<select id="reviewAllList" resultType="Board">
		select *
		from (
				select rownum rn, e.*
				from (
		               select a.id, c.title, a.content_id, a.content, b.name, a.score,
		               		  a.created_at, a.big_code, a.small_code
		               from 
		                    board a
		               join 
		                    users b
		               on 
		                   	a.user_id = b.id
		               join 
		                    contents c
		               on 
		                   	a.content_id = c.id
		               where c.id = #{content_id}
		               and a.is_deleted = 0 
		        ) e
		)
		where rn between #{start} and #{end}
	</select>
	
	<select id="reviewAllList2" resultType="Board">
		select *
		from (
		    select rownum rn, c.*
		    from (
		        select a.id, a.content, b.name, a.created_at, a.read_count, a.big_code, a.small_code
		        from board a, users b
		        where a.user_id = b.id
		        and a.small_code = 6
		        order by a.id desc
		    ) c
		)
		where rn between #{start} and #{end}
	</select>

	<select id="boardDetail" parameterType="int" resultType="Board">
		select *
		from board a, users b
		where a.user_id = b.id
		and a.id = #{boardId}
	</select>
	
	<update id="boardUpdate" parameterType="Board">
		update board
		set
			title = #{title},
			content = #{content},
			updated_at = sysdate
		where id = #{id}
	</update>
		
	<delete id="boardDelete" parameterType="int">
		delete from board where id = #{boardId}
	</delete>	
	
	<insert id="boardInsert" parameterType="Board">
		<selectKey keyProperty="id" resultType="integer" order="BEFORE">
			select board_seq_generator.nextval from dual
		</selectKey>
		insert into board (id, user_id, big_code, small_code, 
						   title, content, read_count, file_name, 
						   file_path, created_at, is_deleted) 
		values(#{id}, #{user_id}, #{big_code}, #{small_code}, 
			   #{title}, #{content}, 0, #{file_name}, #{file_path}, sysdate, 0)		
	</insert>
	
	<insert id="reviewBoardInsert" parameterType="Board">
		<selectKey keyProperty="id" resultType="integer" order="BEFORE">
			select board_seq_generator.nextval from dual
		</selectKey>
		insert into board (id, content_id, user_id, big_code, small_code, 
						   title, content, score, created_at, is_deleted) 
		values(#{id}, #{content_id}, #{user_id}, #{big_code},
			   #{small_code}, #{title}, #{content}, #{score}, sysdate, 0)		
	</insert>
	
	<select id="testRead" parameterType="int" resultType="Board">
		select *
		from board
		where id = #{id}
	</select>
	
</mapper>