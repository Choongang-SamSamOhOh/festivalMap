<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oracle.s202350104.FavoriteMapper">
	
	<select id="joFavoriteListAll" resultType="Favorite" parameterType="Favorite">
		SELECT *
		FROM   
			   (
			   	SELECT ROWNUM rn, f.*, u.name
			 	FROM   favorite f, users u
			 	WHERE  f.user_id = u.id
				) 
		WHERE rn BETWEEN #{start} and #{end}
	</select>
		
		
	<select id="joFavoriteTotal" resultType="int">
		SELECT count(*)
		FROM   favorite
	</select>
	
	
	<select id="joCondTotalFavorite" resultType="int" parameterType="Favorite">
		SELECT count(*) FROM favorite
		
		<choose>
			<when test="search == 's_id'">
				WHERE user_id like '%' || #{keyword} || '%'
			</when>
			<when test="search == 's_name'">
				WHERE name like '%' || #{keyword} || '%'
			</when>
			<otherwise>
				WHERE user_id like '%'
			</otherwise>
		</choose>
	</select>
	
	
	<select id="joListSearchFavorite" parameterType="Favorite" resultType="Favorite">
		
		SELECT *
		FROM
		(
			SELECT rownum rn, f.*, u.name
			FROM   favorite f, users u
			WHERE  f.user_id = u.id		
		)
		WHERE rn BETWEEN #{start} and #{end}
		
		<choose>
			<when test="search == 's_id'">
				AND user_id like '%' || #{keyword} || '%'
			</when>
			<when test="search == 's_name'">
				AND name like '%' || #{keyword} || '%'
			</when>
			<otherwise>
				AND user_id like '%'
			</otherwise>
		</choose>
			
	</select>
	
	<select id="joGetMyLikeList" parameterType="Favorite" resultType="Favorite">
		SELECT *
		FROM
		(
			SELECT rownum rn, f.id, c.title, f.create_at
			FROM   contents c, favorite f
			WHERE  f.user_id = '1003'
			AND    f.id = c.id
		)
		WHERE rn between #{start} and #{end}
		
	</select>

	<select id="joTotalMyLikeList" parameterType="Favorite" resultType="int">
		SELECT COUNT(*)
		FROM   favorite f  
		WHERE  f.user_id = 1003
    </select>
    
    <delete id="joDeleteMyLike" parameterType="int">
		DELETE FROM favorite 
		WHERE  user_id = '1003' 
		AND    content_id = #{content_id}
    </delete>
    
    <delete id="joDeleteFavorite" parameterType="favorite">
		DELETE FROM favorite 
		WHERE  user_id = #{user_id} 
		AND    content_id = #{content_id}
    </delete>
    
    <select id="joDetailFavorite" parameterType="Favorite" resultType="Favorite">
		SELECT f.*, u.name
		FROM 	users u, (
							SELECT *
							FROM   favorite f  
							WHERE  f.user_id = #{user_id} AND f.id = #{id} ) f
		WHERE u.id = f.user_id		
    </select>
    
    <select id="getMyFavoriteOne" parameterType="Favorite" resultType="Favorite">
		SELECT *
		FROM   favorite f  
		WHERE  f.user_id = #{user_id} 
		AND f.content_id = #{content_id} 
    </select>
    
    <update id="joUpdateFavorite" parameterType="Favorite">
		UPDATE favorite
		SET    create_at = #{create_at)
		WHERE  user_id = #{user_id} AND content_id = #{content_id}
	</update>
    
    
    <insert id="joInsertFavorite" parameterType="Favorite" >
    	INSERT INTO favorite(user_id, content_id ,create_at) 
    	VALUES(#{user_id}, #{content_id}, sysdate)
    </insert>
</mapper>
